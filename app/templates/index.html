<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ title }}</title>
  <script src="https://unpkg.com/htmx.org@2.0.3"></script>
  <style>
    :root { --fg:#e5e7eb; --muted:#cbd5e1; --card:#111217cc; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin:0;
      min-height:100vh;
      font-family:system-ui,Segoe UI,Roboto,Ubuntu,Arial;
      color:var(--fg);
      background: #0b0a0a url('/static/fond.png') center center / cover no-repeat fixed;
    }
    .wrap {
      position:absolute;
      left: {{ offset_x }};
      top: {{ offset_y }};
      transform: translate(-50%, -50%);
      width:min(92vw, 820px);
      padding:28px;
      background:var(--card);
      border-radius:20px;
      backdrop-filter: blur(6px);
      box-shadow: 0 10px 30px #0008;
    }
    h1 { margin:0 0 6px; font-weight:800; font-size:28px; letter-spacing:0.2px; text-align:center; }
    .subtitle { margin:0 0 18px; font-size:14px; color:#cbd5e1aa; text-align:center; }
    .row { padding:12px; background:#0f1115; border-radius:14px; display:grid; grid-template-columns:1fr auto auto; gap:12px; align-items:center; }
    .label { color:var(--muted); font-size:14px; }
    .value { font-variant-numeric:tabular-nums; font-size:28px; font-weight:800; }
    button { appearance:none; border:0; border-radius:10px; padding:10px 14px; font-weight:800; cursor:pointer; background:#2a2d34; color:var(--fg); }
    button.inc { background:#1d3d2b; }
    button.dec { background:#4a2225; }
    .big-total { margin-top:24px; text-align:center; font-size:64px; font-weight:900; }
    /* Actions bottom-right */
    .actions {
      position: fixed;
      right: 20px;
      bottom: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }
    .reset-btn { padding:12px 20px; border-radius:10px; font-weight:800; background:#552222; color:white; cursor:pointer; }
    .reload-btn { padding:10px 16px; border-radius:10px; font-weight:800; background:#225555; color:white; cursor:pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>{{ title }}</h1>
    <p class="subtitle">Entrées & Billets</p>

    <div class="row">
      <div>
        <div class="label">Entrées</div>
        <div class="value" id="entries-value">{{ entries }}</div>
      </div>
      <form hx-post="/update" hx-trigger="submit" hx-swap="none">
        <input type="hidden" name="key" value="entries" />
        <input type="hidden" name="delta" value="-1" />
        <button class="dec" type="submit">−</button>
      </form>
      <form hx-post="/update" hx-trigger="submit" hx-swap="none">
        <input type="hidden" name="key" value="entries" />
        <input type="hidden" name="delta" value="+1" />
        <button class="inc" type="submit">+</button>
      </form>
    </div>

    <div class="row" style="margin-top:12px">
      <div>
        <div class="label">Billets</div>
        <div class="value" id="tickets-value">{{ tickets }}</div>
      </div>
      <form hx-post="/update" hx-trigger="submit" hx-swap="none">
        <input type="hidden" name="key" value="tickets" />
        <input type="hidden" name="delta" value="-1" />
        <button class="dec" type="submit">−</button>
      </form>
      <form hx-post="/update" hx-trigger="submit" hx-swap="none">
        <input type="hidden" name="key" value="tickets" />
        <input type="hidden" name="delta" value="+1" />
        <button class="inc" type="submit">+</button>
      </form>
    </div>

    <div id="state" class="big-total">
      {{ total }}
    </div>
  </div>

  <!-- Actions floating bottom-right -->
  <div class="actions">
    <form hx-post="/reset" hx-trigger="submit" hx-swap="none" onsubmit="return confirm('Remettre à zéro les compteurs ?');">
      <button type="submit" class="reset-btn">Reset</button>
    </form>
    <form hx-post="/reload-config" hx-trigger="submit" hx-swap="none" hx-on::after-request="if (event.detail.successful) location.reload()">
      <button type="submit" class="reload-btn">Reload Config</button>
    </form>
  </div>

  <script>
    document.addEventListener('htmx:afterOnLoad', function(evt) {
      try {
        const d = JSON.parse(evt.detail.xhr.responseText);
        if (typeof d.entries !== 'undefined') { document.getElementById('entries-value').textContent = d.entries; }
        if (typeof d.tickets !== 'undefined') { document.getElementById('tickets-value').textContent = d.tickets; }
        if (typeof d.total !== 'undefined')   { document.getElementById('state').textContent = d.total; }
      } catch(e) { /* no-op */ }
    });
  </script>
</body>
</html>
